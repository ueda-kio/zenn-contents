---
title: "Git過去改変ことはじめ【初心者向け】"
emoji: "🐦"
type: "tech"
topics: [Git]
published: false
---

## はじめに
Gitの過去を改変する、かんたんなトピックをまとめていきます。
n番煎じですが、私自身が普段よく使用するコマンドたちを紹介します。いつもお世話になっております（意味深）。


:::message alert
リモートブランチにpush済みのコミットを改変する場合、強制プッシュ`git push -f(/--force-with-lease)`が必要で、コンフリクトが発生します。
仮に該当ブランチを他メンバーがpullしていた場合、そのメンバーに迷惑がかかる恐れがあります。極力push済みのコミットは改変しない方が得策です。
（protectされているブランチはそもそも強制プッシュが不可だったりします。）
:::

## 結論
直前のコミットを改変するには、`git commit --amend`。
2つ以上前のコミットを改変するには、`git rebase -i`。

## 直前のコミットを改変したい: `git commit --amend`

### トピック①: 直前のコミットのコミットメッセージを変更したい
「あ、コミットメッセージ間違えてコミットしちゃった...」
「あ、コミットメッセージにプレフィックスつけ忘れちゃった...」
など、直前のコミットメッセージを修正したいこと、よくあると思います。
そんな時は`git commit --amend`です。

```shell
git commit --amend -m "修正メッセージ"
```

![](/images/8673ee20afedee/2023-05-23-23-46-13.png)
*改変前*

![](/images/8673ee20afedee/2023-05-23-23-48-01.png)


![](/images/8673ee20afedee/2023-05-23-23-47-36.png)
*改変後*

:::details ちなみに
`-m`オプションをつけない場合、エディタモードが展開して直前のコミットメッセージを修正できます。
「プレフィクスつけ忘れた」など軽微なメッセージ修正の場合はこちらの方が適しているかと思われます。

![](/images/8673ee20afedee/2023-05-23-23-51-57.png)
:::


### トピック②: 直前のコミットに混ぜてコミットしたい
「あ、この差分ステージングから漏れてたのにコミットしちゃった...」
など、ある差分を直前のコミットに混ぜてコミットしたいこと、よくあると思います。
そんな時は`git commit --amend --no-edit`です。


![](/images/8673ee20afedee/2023-05-24-00-03-50.png)
*改変前（`h1`の差分のみ）*

```shell
git add .
git commit --amend --no-edit
```

![](/images/8673ee20afedee/2023-05-24-00-03-44.png)
*改変後（直前のコミットに`p`の差分も追加されている）*

:::details Gitのエイリアスについて
この直前のコミットに混ぜてコミットするという過去改変、個人的にとてもよく使うためエイリアスにコマンドを登録しています。

```shell
git cma
# = git commit --amend --no-edit
```

エイリアスの登録方法はこちらの記事をご参照まで。

https://zenn.dev/tanaka_takeru/articles/b7434259330e11

:::


## 2つ以上前のコミットを改変したい: `git rebase -i`

### トピック③: 2つ以上前のコミットのコミットメッセージを変更したい
「あ、よく考えたらこの4つ前のコミット、メッセージがおかしいな...」
みたいなこと、よくあると思います。
`git commit --amend`で改変できるのは直前のコミットのみなので、2つ以上前のコミットを改変しようとすると大変です。
（コミットを1つ1つ`git reset --soft HEAD^`でリセットして`git stash`で格納し混ぜたいコミットの直前まで移動する、という方法でできなくもないですが、とても大変です。）

`git rebase -i HEAD~{n}`でnつ前までのコミットを改変できます。


### トピック④: 2つ以上前のコミットに差分を混ぜたい
「この差分2つ前のコミットと一緒に積むべきだったな...」
「『漏れていたためコミット』ていうコミット積みたくないな...」
など、ある差分を2つ以上前のコミットに混ぜてコミットしたいこと、よくあると思います。

