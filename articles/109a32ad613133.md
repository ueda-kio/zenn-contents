---
title: "ã€HTMLã€‘ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè£…æ–¹æ³•ã‚’ã‚‚ã†ä¸€åº¦è¦‹ç›´ã—ã¦ã¿ã‚‹ã€ç”ŸJavaScriptã€‘"
emoji: "ğŸ¦"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [html, javascript]
published: false
---

```js
window.addEventListener('DOMContentLoaded', () => {
  /** @type {HTMLFormElement} */
  const form = document.getElementById('form');
  const validateInstance = new CustomValidate(form);
  validateInstance.init();
});
```


htmlã®ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢ã—ã¦Web APIã«æ¨™æº–æ­è¼‰ã•ã‚Œã¦ã„ã‚‹æ©Ÿèƒ½ã‚’æ”¹ã‚ã¦è¦‹ç›´ã—ã€ã©ã®ã‚ˆã†ã«ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹ã¹ãã‹è¦‹ç›´ã—ã¾ã—ãŸã€‚
è‡ªåˆ†ã®ä¸­ã§æ¤œè¨ã‚’è¡Œãªã£ãŸå‚™å¿˜ã‚’å…¼ã­ã¦è¨˜äº‹ã«æ®‹ã—ã¾ã™ã€‚

## ã¯ã˜ã‚ã«
ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã‚ãªã„ã§å®Ÿè£…ã—ã¾ã™ã€‚
htmlã¨ãƒãƒ‹ãƒ©ï¼ˆç”Ÿï¼‰ã®jsã§å®Ÿè£…ã—ã¦ã„ãã¾ã™ã€‚


## å®Ÿè£…æ–¹é‡
htmlæ¨™æº–ã®æ©Ÿèƒ½ã‚’å­˜åˆ†ã«ä½¿ã£ã¦ã„ãã€‚

ã‚ˆãã‚ã‚‹å®Ÿè£…ä¾‹ã€‚

```js:AsIs
// html
<input type="text" id="text">
<span id="errorMessage"></span>

// js
const input = document.getElementById('text');
const errorMessage = document.getElementById('errorMessage');
if (input.value === '') {
  errorMessage.textContent = 'å¿…é ˆé …ç›®ã§ã™ã€‚';
}
```
`invalid`ã®æ¡ä»¶ã‚‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚è‡ªåˆ†ã§è¨­å®šã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚



![sample](/images/109a32ad613133/2023-05-07-21-57-21.png)

htmlã®æ¨™æº–æ©Ÿèƒ½ã‚’ä½¿ãˆã°ãã®å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```js:ToBe
//html
<input type="text" id="text" required>
<span id="errorMessage"></span>

//js
const input = document.getElementById('text');
const errorMessage = document.getElementById('errorMessage');
if (input.checkValidity()) {
  errorMessage.textContent = input.validationMessage;
}
```



![C915EED2-2E73-405C-8DBA-0E30B4C50404.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/a1492f4d-44cb-8737-fa4d-028b4d2abbd5.png)


### ãªã«ãŒå¬‰ã—ã„ã®ï¼Ÿ

htmlæ¨™æº–ã§å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚


e.g.)

1. ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯
![198AD9CF-8456-4833-BA7C-B266803206FC.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/33f13b19-d6db-0ece-fe6c-672af39bc957.png)

2. URLå½¢å¼ãƒã‚§ãƒƒã‚¯
![69FC92DF-E7B0-40BE-98A9-4915DDC0B52D.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/90e04863-9e7b-f0b5-82cd-1dd4108474e6.png)

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚æ¨™æº–ã§ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€è‡ªå‰ã§è¨­å®šã™ã‚‹å¿…è¦ã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚
ï¼ˆæ–‡è¨€ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ - å¾Œè¿°ï¼‰



## å…·ä½“å®Ÿè£…ä¾‹

### step1. ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

ã¾ãšã¯è¶…ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãªhtmlæ¨™æº–ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã€‚
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã«é–¢ã™ã‚‹jsã¯ä¸€åˆ‡æ›¸ã„ã¦ã„ã¾ã›ã‚“ã€‚æ¨™æº–æ©Ÿèƒ½ã®ã¿ã§å®Ÿç¾å¯èƒ½ã§ã™ã€‚

[*ã“ã“ã«åŸ‹ã‚è¾¼ã¿CodePen*]

<!--
<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="wvYrQZE" data-user="ueda-kio" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/ueda-kio/pen/wvYrQZE">
  Untitled</a> by Men_Tori (<a href="https://codepen.io/ueda-kio">@ueda-kio</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>

<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
-->

ã“ã“ã§ã¯ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ã‚’è¡Œãªã£ã¦ã„ã¾ã™ã€‚

- å¿…é ˆãƒã‚§ãƒƒã‚¯
  - `required`å±æ€§ã‚’ä»˜ä¸ã™ã‚‹ã ã‘
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯
  - `type="email"`ã«ã™ã‚‹ã ã‘
- ä»»æ„ã®å½¢å¼ãƒã‚§ãƒƒã‚¯
  - `pattern`å±æ€§ã«ä»»æ„ã®å½¢å¼ã‚’æ­£è¦è¡¨ç¾ã§è¨­å®š
  - ã“ã“ã§ã¯`banana`ã‚‚ã—ãã¯`cherry`ã¨å…¥åŠ›ã™ã‚‹ã¨`valid`

æ¨™æº–æ©Ÿèƒ½ã§å®Ÿè£…å¯èƒ½ãªãƒã‚§ãƒƒã‚¯é …ç›®ã¯ä»¥ä¸‹ã§ã™ã€‚
å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å½¢å¼ãƒã‚§ãƒƒã‚¯ä»¥å¤–ã«ã‚‚ã€æœ€å¤§/æœ€å°æ–‡å­—æ•°ãƒã‚§ãƒƒã‚¯ãƒ»`pattern`å±æ€§ã«ã‚ˆã‚‹ä»»æ„ã®å½¢å¼ãƒã‚§ãƒƒã‚¯ãªã©æ§˜ã€…ãªãƒã‚§ãƒƒã‚¯ãŒå¯èƒ½ã§ã™ã€‚
åŸºæœ¬çš„ãªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚ã‚Œã°ã€è‡ªå‰ã§å®Ÿè£…ã™ã‚‹ã‚ˆã‚Šã‚‚æ¨™æº–æ©Ÿèƒ½ã‚’ä½¿ã†æ–¹ãŒã‚ˆã„ã§ã—ã‚‡ã†ã€‚

https://developer.mozilla.org/ja/docs/Web/API/ValidityState


### step2. ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

æ¨™æº–ã®ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã¯ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤ºã™ã‚‹å½¢å¼ã¨ãªã£ã¦ã„ã¾ã™ã€‚

â–¼ macOS Chrome ã®å ´åˆ
![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/c2713963-4170-13ca-e3e0-56b7920c1936.png)


ã“ã®ã¾ã¾ã§OKãªã‚‰OKãªã®ã§ã™ãŒã€ã‚µã‚¤ãƒˆã®ãƒˆãƒ³ãƒãƒŠã«ããã‚ãªã„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã£ã¦è¡¨ç¤ºãŒç•°ãªã‚‹ã€ãªã©ã®ç†ç”±ã‹ã‚‰ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼è¦³ç‚¹ã®OKãŒå‡ºãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚ã¾ãŸã€ä¸€å®šæ™‚é–“ã§ã‚¨ãƒ©ãƒ¼é€šçŸ¥ãŒéè¡¨ç¤ºã«ãªã£ã¦ã—ã¾ã†ç‚¹ã‚‚è§£æ¶ˆã—ãŸã„ã‹ã‚‚ã€‚
ã§ã¯step2ã§ã¯ã“ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ãã¾ã™ã€‚

æ¨™æº–ã®ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’è¡¨ç¤ºã•ã›ãªã„ãŸã‚ã«ã¯
- `form`è¦ç´ ã«`novalidate`å±æ€§ã‚’ä»˜ä¸ã—`checkValidity()`ãƒ¡ã‚½ãƒƒãƒ‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹ã€‚
- `input`è¦ç´ ã®`invalid`ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå‡¦ç†ã‚’å®Ÿè£…ã™ã‚‹ã€‚

æ¨™æº–ã®ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã¨ã„ã†APIã¯ç”¨æ„ã•ã‚Œã¦ã„ãªã„ï¼ˆã¨æ€ã‚ã‚Œã‚‹ï¼‰ãŸã‚ã€ã¾ãšã¯`form`è¦ç´ ã«`novalidate`å±æ€§ã‚’ä»˜ä¸ã—æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã‚’ç™ºç«ã•ã›ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚
ã“ã®ã¾ã¾ã§ã¯æœ¬è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«è©æ¬ºã«ãªã£ã¦ã—ã¾ã†ãŸã‚ã€jsã‹ã‚‰`checkValidity()`ã‚’å®Ÿè¡Œã—ã‚¨ãƒ©ãƒ¼ã‚’é€šçŸ¥ã•ã›ãšã«æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã ã‘å®Ÿè¡Œã•ã›ã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/HTMLInputElement/checkValidity


æ¤œè¨¼çµæœã«å•é¡ŒãŒã‚ã‚‹å ´åˆã¯`false`ã‚’è¿”ã—ã€`input`è¦ç´ ã®`invalid`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã¾ã™ã€‚
ã“ã“ã§ã‚«ã‚¹ã‚¿ãƒ ã—ãŸã‚¨ãƒ©ãƒ¼é€šçŸ¥ã‚’è¡¨ç¤ºã•ã›ãŸã„ãŸã‚ã€`input`è¦ç´ ã®`invalid`ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒ©ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå‡¦ç†ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```js:ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
const form = document.getElementById('form');
form.addEventListener(
  'submit',
  (e) => {
    e.preventDefault();
    const isValid = form.checkValidity(); // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    if (isValid) {
      alert('submit!');
    }
  },
  { passive: false }
);

const input = document.getElementById('text');
input.addEventListener('invalid', () => {
  input.classList.add('is-error');
  errorMessage.textContent = input.validationMessage;
});
```

ã–ã£ãã‚Šã¨ã“ã‚“ãªå®Ÿè£…å†…å®¹ã§ã™ã€‚


[*ã“ã“ã«åŸ‹ã‚è¾¼ã¿CodePen*]

<!--
<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="YzJEXyB" data-user="ueda-kio" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/ueda-kio/pen/YzJEXyB">
  Step2</a> by Men_Tori (<a href="https://codepen.io/ueda-kio">@ueda-kio</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
-->

`input.validationMessage`ã§æ¨™æº–æ©Ÿèƒ½ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å–å¾—ã§ãã¾ã™ã€‚ä»Šå›ã¯å…¥åŠ›é …ç›®ä¸‹éƒ¨ã«èµ¤å­—ã§è¡¨ç¤ºã•ã›ã¾ã—ãŸã€‚

https://developer.mozilla.org/ja/docs/Web/API/HTMLObjectElement/validationMessage

ã¾ãšãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Ÿè¡Œæ™‚ã«æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ°ã‚Š



ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚, ãŠã‚ˆã³`reportValidity()`ã«é€šçŸ¥ã•ã‚Œã‚‹ã€‚

https://developer.mozilla.org/ja/docs/Web/HTML/Constraint_validation#%E5%88%B6%E7%B4%84%E6%A4%9C%E8%A8%BC%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9

> `submit()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ `HTMLFormElement` ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã§å‘¼ã³å‡ºã—ã¦ã‚‚ã€åˆ¶ç´„æ¤œè¨¼ã¯è¡Œã‚ã‚Œã¾ã›ã‚“ã€‚è¨€ã„æ›ãˆã‚Œã°ã€ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã¯åˆ¶ç´„ã‚’æº€ãŸã•ãªãã¦ã‚‚ãƒ•ã‚©ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚ä»£ã‚ã‚Šã«é€ä¿¡ãƒœã‚¿ãƒ³ã® `click()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¦ãã ã•ã„ã€‚


### step3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹

`pattern`å±æ€§ã«ã¦æŒ‡å®šã•ã‚ŒãŸæ­£è¦è¡¨ç¾ã¨å…¥åŠ›å€¤ãŒä¸€è‡´ã—ãªã„å ´åˆ`patternMismatch`ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã€macOS Chromeãƒ–ãƒ©ã‚¦ã‚¶ã«ãŠã‘ã‚‹æ¨™æº–ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ã€Œè¦æ±‚ã•ã‚ŒãŸå½¢å¼ã«ä¸€è‡´ã•ã›ã¦ãã ã•ã„ã€‚ã€ã§ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/98f8cc0e-e811-01ee-2b3c-f05be99cb94e.png)


ã—ã‹ã—ã“ã®ã‚¨ãƒ©ãƒ¼é€šçŸ¥ã§ã¯ã€ã©ã®ã‚ˆã†ãªæ–‡å­—ã‚’å…¥åŠ›ã™ã‚Œã°ã‚ˆã„ã®ã‹ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¼ã‚ã‚‰ãšä¸è¦ªåˆ‡ã§ã™ã€‚
æ¬¡ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹æ–¹æ³•ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚


`setCustomValidity()`ãƒ¡ã‚½ãƒƒãƒ‰ã«æ–‡å­—åˆ—ã‚’æ¸¡ã™ã“ã¨ã§ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚«ã‚¹ã‚¿ãƒ ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸãã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨åŒæ§˜ã«`validationMessage`ã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/HTMLInputElement/setCustomValidity

ã‚¨ãƒ©ãƒ¼ã®ç¨®é¡ã¯[`ValidityState`](https://developer.mozilla.org/ja/docs/Web/API/HTMLObjectElement/validity)ã‹ã‚‰åˆ¤åˆ¥å¯èƒ½ã§ã‚ã‚Šã€`patternMismatch`ã®å ´åˆã€ã¤ã¾ã‚Š`input.validity.patternMismatch`ãŒ`true`ã®å ´åˆã«`setCustomValidity()`ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¨ã—ã¦è¡¨ç¤ºã—ãŸã„æ–‡å­—åˆ—ã‚’æ¸¡ã—ã¾ã™ã€‚

```js:ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
input.addEventListener('invalid', () => {
  input.classList.add('is-error');
  if (input.validity.patternMismatch) {
    input.setCustomValidity('ã€Œbananaã€ã‚‚ã—ãã¯ã€Œcherryã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
  }
  errorMessage.textContent = input.validationMessage;
  input.setCustomValidity(''); //! é€šçŸ¥ãŒå®Œäº†ã—ãŸã‚‰`setCustomValidity`ã«ç©ºæ–‡å­—åˆ—ã‚’æ¸¡ã™ã€‚
});
```

è½ã¨ã—ç©´ãŒã‚ã‚‹ã‚ˆã€‚
`setCustomValidity()`ã«ç©ºæ–‡å­—åˆ—ä»¥å¤–ã®æ–‡å­—åˆ—ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ`invalid`æ‰±ã„ã¨ãªã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚


> ã‚¨ãƒ©ãƒ¼ãŒãªã„å ´åˆã¯ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç©ºæ–‡å­—åˆ—ã«è¨­å®šã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒç©ºã§ãªã„é™ã‚Šã€ãƒ•ã‚©ãƒ¼ãƒ ã¯æ¤œè¨¼ã‚’é€šéã›ãšã€é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚


å¼•ç”¨: https://developer.mozilla.org/ja/docs/Web/API/HTMLInputElement/setCustomValidity

ãã®ãŸã‚`setCustomValidity()`ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¸¡ã—ã¦ãã‚Œã‚’é€šçŸ¥ã—çµ‚ãˆãŸã‚‰ã€`setCustomValidity()`ã«ç©ºæ–‡å­—åˆ—ã‚’æ¸¡ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

<!--
<p class="codepen" data-height="300" data-default-tab="html,result" data-slug-hash="ZEqabJw" data-user="ueda-kio" style="height: 300px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;">
  <span>See the Pen <a href="https://codepen.io/ueda-kio/pen/ZEqabJw">
  Untitled</a> by Men_Tori (<a href="https://codepen.io/ueda-kio">@ueda-kio</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
-->


======== [IMO] ========

`patternMismatch`ã‚¨ãƒ©ãƒ¼ã®éš›ã€`input`è¦ç´ ã«`title`å±æ€§ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆãã®æ–‡å­—åˆ—ã‚‚ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

â–¼ `title`å±æ€§ã«`ã€Œbananaã€ã‚‚ã—ãã¯ã€Œcherryã€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚`ã‚’è¨­å®šã—ãŸå ´åˆ

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/34791a43-b581-77bd-f192-a1ca9d1e1f46.png)

ã“ã®ä»•æ§˜ã«æº–ã˜ã‚‹å ´åˆã€ã‚«ã‚¹ã‚¿ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚htmlã®`title`å±æ€§ã«ã¦ç®¡ç†ã—ã€jsã§ã¯ãã‚Œã‚’å–å¾—ãƒ»è¡¨ç¤ºã™ã‚‹å®Ÿè£…æ–¹æ³•ãŒã‚ˆã‚Šé©ã—ã¦ã„ã‚‹ã¨æ€ã‚ã‚Œã¾ã™ã€‚

```js:ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º
input.addEventListener('invalid', () => {
  input.classList.add('is-error');
  if (input.validity.patternMismatch) {
    input.setCustomValidity(input.title); // `title`å±æ€§ã®æ–‡å­—åˆ—ã‚’æ¸¡ã™
  }
  errorMessage.textContent = input.validationMessage;
  input.setCustomValidity('');
});
```

======== [IMO] ========


### step4. ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã‚’è¨­å®šã™ã‚‹

æœ€å¾Œã«æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã§ã¯ãƒã‚§ãƒƒã‚¯ã§ããªã„ç‹¬è‡ªã®ãƒã‚§ãƒƒã‚¯è¦ä»¶ãŒã‚ã‚‹å ´åˆã®å®Ÿè£…æ–¹æ³•ã‚’è¦‹ã¦ã„ãã¾ã™ã€‚

ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã¯ã“ã‚Œã¾ã§ã¨ç•°ãªã‚Š`invalid`ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©å†…ã§æ¡ä»¶åˆ†å²ã•ã›ã‚‹ã ã‘ã§ã¯å®Ÿè£…ã§ãã¾ã›ã‚“ã€‚ãªãœãªã‚‰ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã§ã¯ãŸã¨ãˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœãŒ`false`ã§ã‚ã£ã¦ã‚‚`form.checkValidity()`å®Ÿè¡Œæ™‚ã«`false`ã¨ãªã‚‰ãšã«ãã‚‚ãã‚‚`invalid`ã‚¤ãƒ™ãƒ³ãƒˆãŒèµ°ã‚‰ãªã„ãŸã‚ã§ã™ã€‚

ãã®ãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã«å„å…¥åŠ›é …ç›®è¦ç´ ãã‚Œãã‚Œã§`inputElement.checkValidity()`ã‚’å®Ÿè¡Œã—ã€å…¥åŠ›é …ç›®ãŒç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ¤œæŸ»ã®å¯¾è±¡ã®å ´åˆãã®æ¡ä»¶å¼ã«é€šã—ã€`invalid`ã®å ´åˆ`setCustomValidity()`ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã€ã¨ã„ã†å®Ÿè£…ã‚’è¡Œã„ã¾ã™ã€‚


```js
const form = document.getElementById('form');
const input = document.getElementById('text');

const validate = (input) => {
  if (input.hasAttribute('data-validate')) {
    if (input.value !== '1') { // ç‹¬è‡ªãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶
      input.setCustomValidity('ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã«åã—ã¦ã„ã‚‹æ—¨ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸');
    } else {
      input.setCustomValidity('');
    }
  }
  input.checkValidity();
};

form.addEventListener(
  'submit',
  (e) => {
    e.preventDefault();
    validate(input); // å„å…¥åŠ›é …ç›®ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
    const isValid = form.checkValidity();
    if (isValid) {
      alert('submit!');
    }
  },
  { passive: false }
);

input.addEventListener('invalid', () => {
  input.classList.add('is-error');
  errorMessage.textContent = input.validationMessage;
});
```
====== [è£œè¶³] ======

ã“ã“ã§ã¯ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã€Œå…¥åŠ›ãƒ‡ãƒ¼ã‚¿ãŒ`1`ä»¥å¤–`invalid`ã€ã¨ã—ã¦ã„ã¾ã™ã€‚
æœ¬æ¥ã“ã®ãƒ«ãƒ¼ãƒ«ãªã‚‰`pattern`å±æ€§ã§ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¹ãã§ã™ãŒã€ä»Šå›ã¯èª¬æ˜ã®ãŸã‚ã‚ã–ã¨ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¦ã„ã¾ã™ã€‚

====== [è£œè¶³] ======

`setCustomValidity()`ã«ç©ºæ–‡å­—åˆ—ä»¥å¤–ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚Œã°`input.checkValidity()`ã‹ã‚‰`invalid`ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã•ã›ã‚‹ã“ã¨ãŒã§ãã€æ¨™æº–ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ã¨åŒæ§˜ã«ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã‹ã¤ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã«å¯¾ã™ã‚‹`form.checkValidity()`ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚‚`false`ã‚’è¿”ã™ãŸã‚ã€ã€Œã™ã¹ã¦ã®å…¥åŠ›é …ç›®ãŒ`valid`ã®å ´åˆã«ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡å®Ÿè¡Œã€ã¨ã„ã†æ„å›³ã—ãŸæ¤œæŸ»çµæœã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚



### å…¨éƒ¨ä¹—ã›å®Ÿè£…ä¾‹

```js:å…¨éƒ¨ä¹—ã›å®Ÿè£…ä¾‹
(() => {
  class Validate {
    /** @type {HTMLFormElement} */
    #form;
    /** @type {Array<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>} */
    #formElms;
    /** @type {Array<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>} */
    #customRuleFormElms;

    /** @param {HTMLFormElement} form */
    constructor(form) {
      this.#form = form;
      this.#formElms = [...this.#form.elements].filter(
        (elm) => elm instanceof HTMLInputElement || elm instanceof HTMLSelectElement || elm instanceof HTMLTextAreaElement
      );
      this.#customRuleFormElms = this.#formElms.filter((elm) => elm.hasAttribute('data-custom-rule'));
    }

    /**
     * @summary `#getElms`ãƒ¡ã‚½ãƒƒãƒ‰ã®è¿”ã‚Šå€¤ã®å‹ã‚’å®šç¾©
      * @typedef {Object} ReturnElms
      * @property {Element} wrapper - å…¥åŠ›é …ç›®ãƒ©ãƒƒãƒ‘ãƒ¼è¦ç´ 
      * @property {Element} errorMessage - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¦ç´ 
      */
    /**
     * å¼•æ•°ã‹ã‚‰å—ã‘å–ã£ãŸå…¥åŠ›é …ç›®ã«é–¢é€£ã™ã‚‹è¦ç´ ã‚’å–å¾—ã™ã‚‹
      * @param {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} input å…¥åŠ›é …ç›®
      * @returns {ReturnElms}
      */
    #getElms(input) {
      const wrapper = input.closest('[data-wrapper]');
      const errorMessage = wrapper?.querySelector('.errorMessage');
      if (!wrapper || !errorMessage) {
        return console.warn(new Error());
      }
      return { wrapper, errorMessage };
    }

    /**
     * å…¥åŠ›é …ç›®ä¸‹éƒ¨ã«ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      * @param {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} input å…¥åŠ›é …ç›®
      * @param {string} message ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
      */
    #displayErrorState(input, message) {
      const { wrapper, errorMessage } = this.#getElms(input);
      wrapper.classList.add('is-error');
      errorMessage.textContent = message || input.validationMessage;
    }

    /**
     * å¼•æ•°ã‹ã‚‰å—ã‘å–ã£ãŸå…¥åŠ›é …ç›®ã®ã‚¨ãƒ©ãƒ¼çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢
      * @param {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} input å…¥åŠ›é …ç›®
      */
    #resetErrorState(input) {
      const { wrapper, errorMessage } = this.#getElms(input);
      wrapper.classList.remove('is-error');
      errorMessage.textContent = '';
      input.setCustomValidity('');
    }

    /**
     * ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«
      * @param {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} input å…¥åŠ›é …ç›®
      */
    checkCustomValidation(input) {
      if (input.getAttribute('data-custom-rule') === 'test') {
        if (input.value !== '' && input.value !== '1') {
          input.setCustomValidity(input.title);
        } else {
          input.setCustomValidity('');
        }
      }
    }

    /**
     * å¼•æ•°ã«æ¸¡ã•ã‚ŒãŸè¦ç´ ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹
      * @param {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} input å…¥åŠ›é …ç›®
      */
    #validateTargetInput(input) {
      this.#resetErrorState(input);
      // ã‚«ã‚¹ã‚¿ãƒ ãƒ«ãƒ¼ãƒ«ã®å¯¾è±¡ã®å ´åˆ
      if (this.#customRuleFormElms.includes(input)) {
        this.checkCustomValidation(input);
      }
      input.checkValidity();
    }

    /**
     * `invalid`æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
      * - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      * @param {Event} e
      */
    #handleInvalid(e) {
      /** @type {HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement} */
      const input = e.currentTarget;

      if (input.validity.valueMissing) {
        // input.setCustomValidity('å¿…é ˆå…¥åŠ›é …ç›®ã§ã™ã€‚');
        this.#displayErrorState(input, input.validationMessage);
      } else if (input.validity.patternMismatch) {
        input.setCustomValidity(input.title);
        this.#displayErrorState(input, input.validationMessage);
      } else {
        this.#displayErrorState(input, input.validationMessage);
      }
    }

    /**
     * ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ãƒãƒ³ãƒ‰ãƒ©é–¢æ•°
      * @param {Event} e
      */
    #handleSubmit(e) {
      e.preventDefault();
      this.#formElms.forEach((formElm) => this.#validateTargetInput(formElm));
      const isValid = this.#form.checkValidity();
      if (!isValid) {
        const firstInvalidInput = this.#formElms.find((formElm) => !formElm.validity.valid);
        firstInvalidInput.focus();
        return;
      }

      // ä»¥é™validã®å ´åˆ
      alert('valid!');
    }

    /** @summary å„ç¨®ãƒãƒ³ãƒ‰ãƒ©ã®ç™»éŒ² */
    #registerEventListener() {
      this.#formElms.forEach((formElm) => {
        // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãƒ»ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ãƒ»ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ã®å ´åˆã¯`change`ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã«å†æ¤œè¨¼ç™ºç«
        if (formElm.type === 'radio' || formElm.type === 'checkbox' || formElm instanceof HTMLSelectElement) {
          formElm.addEventListener('change', (e) => this.#validateTargetInput(e.currentTarget));
        } else {
          formElm.addEventListener('blur', (e) => this.#validateTargetInput(e.currentTarget));
        }
        formElm.addEventListener('invalid', (e) => this.#handleInvalid(e));
      });

      this.#form.addEventListener('submit', (e) => this.#handleSubmit(e), { passive: false });
    }

    init() {
      if (!this.#formElms.length) return;
      this.#registerEventListener();
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    /** @type {HTMLFormElement} */
    const form = document.getElementById('form');
    const validateInstance = new CustomValidate(form);
    validateInstance.init();
  });
})();
```



## å•é¡Œã¨ãªã‚Šã†ã‚‹ç‚¹

ã„ãã¤ã‹å•é¡Œã¨ãªã‚Šã†ã‚‹ç‚¹ãŒã‚ã‚‹ã‚ˆã€‚

### 1. `validationMessage`ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¾å­˜

æ¨™æº–æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚Œã°ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è‡ªåˆ†ã§è€ƒãˆã‚‹å¿…è¦ãŒãªã„ã¨ã„ã†åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ãŒã€ãã®æ¨™æº–ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä¾å­˜ã§ã‚ã‚Šãƒ–ãƒ©ã‚¦ã‚¶ã€OSé–“ã§æ–‡è¨€ãŒç•°ãªã‚Šã¾ã™ã€‚
ç‰¹ã«å¥èª­ç‚¹ã®æœ‰ç„¡ãŒ

<details>
<summary>å„OSæ¯ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã®å‚è€ƒç”»åƒ</summary>
<div>


</div>
</details>



| OS | å‚è€ƒç”»åƒ |
|:----:|:----:|
| macOS Chrome | ![C915EED2-2E73-405C-8DBA-0E30B4C50404.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/6a0dae85-8af2-1590-e32e-f399c926463c.png) |
| macOS Safari | ![739C0B96-86E2-434E-94BA-E66CD4EE4F06.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/00d3c61a-1d08-3c90-b399-66a2333c7e37.png) |
| macOS Firefox | ![F634A40C-F389-4943-A8DB-BE58EB75A184.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/c58497a6-80b9-20f1-38db-6d179edfd364.png) |
| Android Chrome | ![375F04A4-04F4-4DD0-B1BC-13F8C8DAEFC5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/1875e1d2-7e0e-7b22-b546-b1f5f0daafdc.png) |
| iOS Safari | ![unnamed.jpg](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/1157551/611f37a5-7484-81b1-3341-027f7f028875.jpeg) |


### 2. è¤‡æ•°ã®ã‚¨ãƒ©ãƒ¼ã‚’åŒæ™‚ã«è¡¨ç¤ºã§ããªã„

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’`validationMessage`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰å–å¾—ã€è¡¨ç¤ºã—ã¦ã„ã¾ã™ãŒã€ä»•æ§˜ä¸Šè¤‡æ•°ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åŒæ™‚ã«å–å¾—ã™ã‚‹ã“ã¨ãŒã§ããªã„ãŸã‚ã€`ValidityState`ã«è¤‡æ•°ã®`false`ãŒã‚ã‚‹å ´åˆã‚„åŒæ™‚ã«ç‹¬è‡ªã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¦ä»¶ãŒã‚¨ãƒ©ãƒ¼ã¨ãªã£ã¦ã„ã‚‹å ´åˆã§ã‚ã£ã¦ã‚‚ã€åŒæ™‚ã«è¡¨ç¤ºã§ãã‚‹ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯ï¼‘ã¤ã®ã¿ã¨ãªã‚Šã¾ã™ã€‚


## ã•ã„ã”ã«